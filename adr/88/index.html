<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Authorization for fleet-manager admin APIs | Application Services Architecture</title>
<meta name="generator" content="Jekyll v4.2.2" />
<meta property="og:title" content="Authorization for fleet-manager admin APIs" />
<meta name="author" content="ppaszki" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Context and Problem Statement The purpose of this ADR is to define a standardized approach for securing admin API in a fleet manager" />
<meta property="og:description" content="Context and Problem Statement The purpose of this ADR is to define a standardized approach for securing admin API in a fleet manager" />
<link rel="canonical" href="https://architecture.bf2.dev/adr/88/" />
<meta property="og:url" content="https://architecture.bf2.dev/adr/88/" />
<meta property="og:site_name" content="Application Services Architecture" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2023-04-17T14:56:12+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Authorization for fleet-manager admin APIs" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"ppaszki"},"dateModified":"2023-04-17T14:56:12+00:00","datePublished":"2023-04-17T14:56:12+00:00","description":"Context and Problem Statement The purpose of this ADR is to define a standardized approach for securing admin API in a fleet manager","headline":"Authorization for fleet-manager admin APIs","mainEntityOfPage":{"@type":"WebPage","@id":"https://architecture.bf2.dev/adr/88/"},"url":"https://architecture.bf2.dev/adr/88/"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="https://architecture.bf2.dev/feed.xml" title="Application Services Architecture" /></head>
<body><link rel="icon" type="image/png" href="/favicon.png">
<header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Application Services Architecture</a>


    <nav class="site-nav">
      <input type="checkbox" id="nav-trigger" class="nav-trigger" />
      <label for="nav-trigger">
        <span class="menu-icon">
          <svg viewBox="0 0 18 15" width="18px" height="15px">
            <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
          </svg>
        </span>
      </label>

      <div class="trigger">
        <a class="page-link" href="/about/">About</a>
        <a class="page-link" href="/overview/">Overview</a>
        <a class="page-link" href="/context/">Context</a>
        <a class="page-link" href="/padr/">PADRs</a>
        <a class="page-link" href="/adr/">ADRs</a>
        <a class="page-link" href="/ap/">APs</a>
        <a class="page-link" href="/glossary/">Glossary</a>
        <!-- <a class="page-link" href="/component/">Components</a> -->
      </div>
    </nav></div>
</header>
<div class="wrapper">
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <link rel="stylesheet" href="/css/adr.css">
<article class="post">

  <!-- <header class="post-header">
    <h1 class="post-title">Authorization for fleet-manager admin APIs</h1>
  </header> -->

  <div class="post-content">
    <article class="post">
  <header class="post-header">
    <h1 class="post-title">ADR-88: Authorization for fleet-manager admin APIs</h1>
  </header>

  <div>
    <div>Status: <span class="status-draft">Draft</span>
    
    </div>
    <div>Authors:
      
      
      
      
      ppaszki
      
    </div>
    
    <div>Tags: 
      
      <span class="tag tag-sso">sso</span>
      
    </div>
    
    
  </div>

  <div class="post-content">
    <div class="post-toc">
      <h2>Contents</h2>
      <ul class="sectlevel1">
<li><a href="#context-and-problem-statement">Context and Problem Statement</a></li>
<li><a href="#goals">Goals</a></li>
<li><a href="#non-goals">Non-goals</a></li>
<li><a href="#current-situation">Current situation</a></li>
<li><a href="#proposal">Proposal</a></li>
<li><a href="#alternatives-considered-rejected">Alternatives Considered / Rejected</a></li>
<li><a href="#challenges">Challenges</a></li>
<li><a href="#dependencies">Dependencies</a></li>
<li><a href="#consequences-if-not-completed">Consequences if not completed</a></li>
</ul>
    </div>
    
    <div class="sect1">
<h2 id="context-and-problem-statement">Context and Problem Statement</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The purpose of this ADR is to define a standardized approach for securing admin API in a fleet manager</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="goals">Goals</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Provide standardized way to secure admin API endpoints for fleet managers</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="non-goals">Non-goals</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="current-situation">Current situation</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="proposal">Proposal</h2>
<div class="sectionbody">
<div class="imageblock">
<div class="content">
<img src="adr-88-admin-api-architecture-diagram.png" alt="architecture diagram">
</div>
</div>
<div class="paragraph">
<p>A Keycloak realm is used to authorize access to admin API endpoint(s).
Such realm contains roles that allow access to endpoints to the privileged API users.
Recommended approach is to create a set of realm roles per environment and name them in the way that indicates the permissions they grant as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>&lt;unique-fleet-manager-prefix&gt;-admin-read-stage</p>
</li>
<li>
<p>&lt;unique-fleet-manager-prefix&gt;-admin-write-stage</p>
</li>
<li>
<p>&lt;unique-fleet-manager-prefix&gt;-admin-full-stage</p>
</li>
<li>
<p>&lt;unique-fleet-manager-prefix&gt;-admin-read-prod</p>
</li>
<li>
<p>&lt;unique-fleet-manager-prefix&gt;-admin-write-prod</p>
</li>
<li>
<p>&lt;unique-fleet-manager-prefix&gt;-admin-full-prod</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Example roles for kas-fleet-manager in production environment along with their permissions:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Role name</th>
<th class="tableblock halign-left valign-top">Allowed permissions</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">kas-fleet-manager-admin-read-prod</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">list permissions (HTTP GET)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">kas-fleet-manager-admin-write-prod</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">list and update permissions (HTTP GET and PUT)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">kas-fleet-manager-admin-full-prod</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">full permissions (HTTP GET, PUT and DELETE)</p></td>
</tr>
</tbody>
</table>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Once Keycloak instance is set up, a privileged user uses their credentials to get a JWT token from Keycloak.</p>
</li>
<li>
<p>The JWT token is sent to a admin API in a HTTP request.</p>
</li>
<li>
<p>Admin API authorization middleware verifies token signature with Public JWKS Certificate and roles included in the JWT token are checked against roles specified in the fleet manager.</p>
</li>
<li>
<p>Matching role for given admin endpoint grants access to the action associated with that endpoint.
Failure to match the required role results in returning 404 error for given admin endpoint.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="adr-88-authentication-flow.png" alt="architecture diagram">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="alternatives-considered-rejected">Alternatives Considered / Rejected</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="challenges">Challenges</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>It needs to be ensured that the permissions are only assigned to the people that should be authorized to access protected resource(s). Standard security practices must applied to both the management of the permissions as well as the management of the access to the Keycloak instance that provides the authorization for the admin API endpoints.</p>
</li>
<li>
<p>A policy/ SOP for revoking access to the admin API roles is required.</p>
</li>
<li>
<p>Potential issues with token size can occur, if certain users are assigned many roles. This can result in increased response time for admin API endpoints and/ or requests being blocked at the gateway.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="dependencies">Dependencies</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="consequences-if-not-completed">Consequences if not completed</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Multiple different solutions might be implemented for securing admin API endpoints across fleet managers</p>
</div>
</div>
</div>  
  </div>

</article>
  
  </div>

</article>

      </div>
    </main><div class="edit">
  <a href="https://github.com/bf2fc6cc711aee1a0c2a/architecture/edit/main/_adr/88/index.adoc">✎ Edit this page</a>
</div>
</div>
<footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Application Services Architecture</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Application Services Architecture</li><li><a class="u-email" href="mailto:mk-support@redhat.com">mk-support@redhat.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"></ul>
</div> 

      <div class="footer-col footer-col-3">
        <p>This site contains resources about the architecture and processes for Red Hat Application Services.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
