<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Fleet manager - fleet shard local autonomy | Application Services Architecture</title>
<meta name="generator" content="Jekyll v4.2.2" />
<meta property="og:title" content="Fleet manager - fleet shard local autonomy" />
<meta name="author" content="Emmanuel Bernard" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="See managed CR. The fleet shard is responsible for implementing a managed custom resource. It has a much autonomy as possible vs the fleet manager:" />
<meta property="og:description" content="See managed CR. The fleet shard is responsible for implementing a managed custom resource. It has a much autonomy as possible vs the fleet manager:" />
<link rel="canonical" href="https://architecture.bf2.dev/ap/4/" />
<meta property="og:url" content="https://architecture.bf2.dev/ap/4/" />
<meta property="og:site_name" content="Application Services Architecture" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2023-04-17T14:56:12+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Fleet manager - fleet shard local autonomy" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Emmanuel Bernard"},"dateModified":"2023-04-17T14:56:12+00:00","datePublished":"2023-04-17T14:56:12+00:00","description":"See managed CR. The fleet shard is responsible for implementing a managed custom resource. It has a much autonomy as possible vs the fleet manager:","headline":"Fleet manager - fleet shard local autonomy","mainEntityOfPage":{"@type":"WebPage","@id":"https://architecture.bf2.dev/ap/4/"},"url":"https://architecture.bf2.dev/ap/4/"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="https://architecture.bf2.dev/feed.xml" title="Application Services Architecture" /></head>
<body><link rel="icon" type="image/png" href="/favicon.png">
<header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Application Services Architecture</a>


    <nav class="site-nav">
      <input type="checkbox" id="nav-trigger" class="nav-trigger" />
      <label for="nav-trigger">
        <span class="menu-icon">
          <svg viewBox="0 0 18 15" width="18px" height="15px">
            <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
          </svg>
        </span>
      </label>

      <div class="trigger">
        <a class="page-link" href="/about/">About</a>
        <a class="page-link" href="/overview/">Overview</a>
        <a class="page-link" href="/context/">Context</a>
        <a class="page-link" href="/padr/">PADRs</a>
        <a class="page-link" href="/adr/">ADRs</a>
        <a class="page-link" href="/ap/">APs</a>
        <a class="page-link" href="/glossary/">Glossary</a>
        <!-- <a class="page-link" href="/component/">Components</a> -->
      </div>
    </nav></div>
</header>
<div class="wrapper">
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <link rel="stylesheet" href="/css/adr.css">
<article class="post">

  <!-- <header class="post-header">
    <h1 class="post-title">Fleet manager - fleet shard local autonomy</h1>
  </header> -->

  <div class="post-content">
    <article class="post">
  <header class="post-header">
    <h1 class="post-title">AP-4: Fleet manager - fleet shard local autonomy</h1>
  </header>

  <div>
    <div>Status: <span class="status-draft">Draft</span>
    
    </div>
    <div>Authors:
      
      
      
      <img class="avatar avatar-small" alt="emmanuelbernard" width="40" height="40" data-proofer-ignore="true" src="https://avatars1.githubusercontent.com/emmanuelbernard?v=3&s=40" srcset="https://avatars1.githubusercontent.com/emmanuelbernard?v=3&s=40 1x, https://avatars1.githubusercontent.com/emmanuelbernard?v=3&s=80 2x, https://avatars1.githubusercontent.com/emmanuelbernard?v=3&s=120 3x, https://avatars1.githubusercontent.com/emmanuelbernard?v=3&s=160 4x" />
      Emmanuel Bernard
      
    </div>
    
  </div>

  <div class="post-content">
    <div class="post-toc">
      <h2>Contents</h2>
      <ul class="sectlevel1">
<li><a href="#what-are-the-reasons-for-this-model-to-be-favored-today">What are the reasons for this model to be favored today</a></li>
</ul>
    </div>
    
    <div class="paragraph">
<p>See managed CR.
The fleet shard is responsible for implementing a managed custom resource.
It has a much autonomy as possible vs the fleet manager:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>it can reject a request</p>
</li>
<li>
<p>It has access to local observability</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The goal is the maximum local autonomy principle.</p>
</div>
<div class="paragraph">
<p>The fleet manager fleet shard refashion ship allows for different topology deployments:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>on customer OSD</p>
</li>
<li>
<p>On red hat owned OSD</p>
</li>
<li>
<p>As a bin packed model</p>
</li>
<li>
<p>As a SaaS</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The same architecture works for all the models.</p>
</div>
<div class="paragraph">
<p>To express remaining capacity, the fleet shard returns the number of ManagedCR types it can hosts.
The fleet manager is not aware of remaining RAM or CPU capacity, it is aware of remaining Kafka of t-shirt size S.
The fleet shard is responsible for t-shirt size to physical resource conversion.
The same fleet shard can answer capacity for different t-shirt sizes.
Each remaining value is not to be understood as reserved but as computed with the existing free resource.
So a deployment of a new instance will update remaining capacity for all t-shirt sizes.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>This model has one limit, the fleet manager is responsible for increasing the infrastructure cluster capacity and needs some knowledge.
Should the fleet shard factors / keep extension capacity? Eg a Kafka cluster going from 3 to 6 brokers?</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Several fleet shard types can be deployed in the same infrastructure cluster.
Likewise, the remaining managed CR capacity is dynamically computed.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>How to deal with reserved capacity for growth and the contract between fleet shard?
Maybe worker pool segregation between fleet shards?</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect1">
<h2 id="what-are-the-reasons-for-this-model-to-be-favored-today">What are the reasons for this model to be favored today</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Why have the fleetshard do these sort of operations. It&#8217;s back to the general general principle of local autonomy.
Since it receives the Managed CR and returns whether it can honor the request, it feels like a natural place to also land the remaining capacity concerns.
The fleetshard has local knowledge of operator Instance CR status, resource usage, remaining "space", local observability, etc which feel useful to compute remaining capacity.
The team handling the bin packing modeling problem (as in how many Kafkas can fit on the head of a pin aka node), tests and choices for given nodes is the instance team where the fleetshard is.
Then there is the explored option of several fleet managers sharing the same data plane OSD clusters. Depending on the (non)isolation model we go with, the resource capacity model is better computable from the local data plane. (Unless there is a grand calculator service that knows of all the binpack characteristics of all services being shared on dataplanes - it&#8217;s a doable model but one that we did not wanted to go with for team autonomy and bin packing maturity concerns).</p>
</div>
</div>
</div>  
  </div>

</article>
  
  </div>

</article>

      </div>
    </main><div class="edit">
  <a href="https://github.com/bf2fc6cc711aee1a0c2a/architecture/edit/main/_ap/4/index.adoc">âœŽ Edit this page</a>
</div>
</div>
<footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Application Services Architecture</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Application Services Architecture</li><li><a class="u-email" href="mailto:mk-support@redhat.com">mk-support@redhat.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"></ul>
</div> 

      <div class="footer-col footer-col-3">
        <p>This site contains resources about the architecture and processes for Red Hat Application Services.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
