<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Dynamic Scaling of Data Plane clusters | Application Services Architecture</title>
<meta name="generator" content="Jekyll v4.2.2" />
<meta property="og:title" content="Dynamic Scaling of Data Plane clusters" />
<meta name="author" content="Manyanda Chitimbo" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Context and Problem Statement" />
<meta property="og:description" content="Context and Problem Statement" />
<link rel="canonical" href="https://architecture.bf2.dev/ap/15/" />
<meta property="og:url" content="https://architecture.bf2.dev/ap/15/" />
<meta property="og:site_name" content="Application Services Architecture" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2023-04-17T14:56:12+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Dynamic Scaling of Data Plane clusters" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Manyanda Chitimbo"},"dateModified":"2023-04-17T14:56:12+00:00","datePublished":"2023-04-17T14:56:12+00:00","description":"Context and Problem Statement","headline":"Dynamic Scaling of Data Plane clusters","mainEntityOfPage":{"@type":"WebPage","@id":"https://architecture.bf2.dev/ap/15/"},"url":"https://architecture.bf2.dev/ap/15/"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="https://architecture.bf2.dev/feed.xml" title="Application Services Architecture" /></head>
<body><link rel="icon" type="image/png" href="/favicon.png">
<header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Application Services Architecture</a>


    <nav class="site-nav">
      <input type="checkbox" id="nav-trigger" class="nav-trigger" />
      <label for="nav-trigger">
        <span class="menu-icon">
          <svg viewBox="0 0 18 15" width="18px" height="15px">
            <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
          </svg>
        </span>
      </label>

      <div class="trigger">
        <a class="page-link" href="/about/">About</a>
        <a class="page-link" href="/overview/">Overview</a>
        <a class="page-link" href="/context/">Context</a>
        <a class="page-link" href="/padr/">PADRs</a>
        <a class="page-link" href="/adr/">ADRs</a>
        <a class="page-link" href="/ap/">APs</a>
        <a class="page-link" href="/glossary/">Glossary</a>
        <!-- <a class="page-link" href="/component/">Components</a> -->
      </div>
    </nav></div>
</header>
<div class="wrapper">
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <link rel="stylesheet" href="/css/adr.css">
<article class="post">

  <!-- <header class="post-header">
    <h1 class="post-title">Dynamic Scaling of Data Plane clusters</h1>
  </header> -->

  <div class="post-content">
    <article class="post">
  <header class="post-header">
    <h1 class="post-title">AP-15: Dynamic Scaling of Data Plane clusters</h1>
  </header>

  <div>
    <div>Status: <span class="status-draft">Draft</span>
    
    </div>
    <div>Authors:
      
      
      
      
      Manyanda Chitimbo, 
      
      
      
      
      Steven Hawkins, 
      
      
      
      <img class="avatar avatar-small" alt="tombentley" width="40" height="40" data-proofer-ignore="true" src="https://avatars2.githubusercontent.com/tombentley?v=3&s=40" srcset="https://avatars2.githubusercontent.com/tombentley?v=3&s=40 1x, https://avatars2.githubusercontent.com/tombentley?v=3&s=80 2x, https://avatars2.githubusercontent.com/tombentley?v=3&s=120 3x, https://avatars2.githubusercontent.com/tombentley?v=3&s=160 4x" />
      Tom Bentley, 
      
      
      
      
      Peter Braun, 
      
      
      
      
      Ramesh Reddy
      
    </div>
    
  </div>

  <div class="post-content">
    <div class="post-toc">
      <h2>Contents</h2>
      <ul class="sectlevel1">
<li><a href="#context-and-problem-statement">Context and Problem Statement</a></li>
<li><a href="#proposed-solution">Proposed solution</a>
<ul class="sectlevel2">
<li><a href="#autoscaling-of-nodes">Autoscaling of nodes</a></li>
<li><a href="#pre-warming-of-nodes-using-pause-pods">Pre-warming of nodes using Pause pods</a></li>
<li><a href="#cluster-full">Cluster Full</a></li>
</ul>
</li>
</ul>
    </div>
    
    <div class="sect1">
<h2 id="context-and-problem-statement">Context and Problem Statement</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In the context of both cost management, as well as having the ability to scale to a (virtually) infinite number of managed instances,
our services must have the capability to dynamically scale its underlying infrastructure.
This implies both scaling up the infrastructure to accommodate more customers, as well as scaling down the infrastructure to manage costs.</p>
</div>
<div class="paragraph">
<p>There are a number of things to consider in the context of dynamic scaling:
. Scaling up/down the number of nodes on an OpenShift Dedicated (OSD)[<a href="https://www.redhat.com/en/technologies/cloud-computing/openshift/dedicated" class="bare">https://www.redhat.com/en/technologies/cloud-computing/openshift/dedicated</a>] cluster
. Provisioning a new OSD cluster
. Removing an OSD cluster
. Pre-warm nodes to ensure standby capacity in order to maintain provisioning latency SLOs for managed instances</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="proposed-solution">Proposed solution</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="autoscaling-of-nodes">Autoscaling of nodes</h3>
<div class="paragraph">
<p>Cluster Autoscaler will be utilized to allow nodes to be created on demand and removed when they are no longer needed.
See <a href="https://github.com/kubernetes/autoscaler/tree/master/cluster-autoscaler#introduction">cluster-autoscaler#introduction</a> for more information.</p>
</div>
</div>
<div class="sect2">
<h3 id="pre-warming-of-nodes-using-pause-pods">Pre-warming of nodes using Pause pods</h3>
<div class="paragraph">
<p>In order to ensure that the managed instance provisioning latency is not impacted by the time it takes for a new node to be provisioned,
it&#8217;s possible to reserve hot capacity by configuring overprovisioning: <a href="https://github.com/kubernetes/autoscaler/blob/master/cluster-autoscaler/FAQ.md#how-can-i-configure-overprovisioning-with-cluster-autoscaler">how to configure overprovisioning</a></p>
</div>
</div>
<div class="sect2">
<h3 id="cluster-full">Cluster Full</h3>
<div class="sect3">
<h4 id="use-node-sizing-formula">Use node sizing formula</h4>
<div class="paragraph">
<p>For binpacked solutions, a node sizing formula can be used to determine if a cluster is full, or not, based on the current number of maximum nodes configured and the current workload. The fleetshard will then propagate the status of the cluster via the managed CR (custom resource) for the control plane to observe and act accordingly.</p>
</div>
</div>
<div class="sect3">
<h4 id="use-metrics">Use metrics</h4>
<div class="paragraph">
<p>It&#8217;s also possible to use the exposed OSD cluster autoscaler metrics - see <a href="https://github.com/kubernetes/autoscaler/blob/master/cluster-autoscaler/proposals/metrics.md#metrics">cluster autoscaler metrics</a>
to determine if the OSD cluster is full or not. The metrics will have to be scraped and stored in Observatorium for the Control Plane to continously poll from and do its logic. This is an advisable pattern for services that do not have a fleetshard.</p>
</div>
</div>
<div class="sect3">
<h4 id="use-the-cluster-autoscaler-events">Use the Cluster autoscaler events</h4>
<div class="paragraph">
<p>The cluster autoscaler emits some events - <a href="https://github.com/kubernetes/autoscaler/blob/master/cluster-autoscaler/FAQ.md#what-events-are-emitted-by-ca">cluster autoscaler events</a>
One of the events emitted on the pods is the <code>NotTriggerScaleUp</code> event which is emitted when autoscaler couldn&#8217;t find node group that can be scaled up to make this pod schedulable. The fleetshard could then check for the emission of the event on any pod its trying to deploy to know if the cluster is full or not. The fleetshard will then communicate the <code>ClusterFull</code> information on the ManagedCR status to the control plane that will re-assign the managed instance to another OSD cluster or eventually create a new OSD cluster capable of accepting new managed instances.</p>
</div>
<div class="paragraph">
<p>It has to be noted that the last two patterns could be used when there are no concerns over impact of cluster full / over commit upon existing workloads i.e the possibility of new workload competing for resources with existing workloads whose Pods have been restarted for one reason or the other thus causing service disruption.</p>
</div>
</div>
</div>
</div>
</div>  
  </div>

</article>
  
  </div>

</article>

      </div>
    </main><div class="edit">
  <a href="https://github.com/bf2fc6cc711aee1a0c2a/architecture/edit/main/_ap/15/index.adoc">âœŽ Edit this page</a>
</div>
</div>
<footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Application Services Architecture</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Application Services Architecture</li><li><a class="u-email" href="mailto:mk-support@redhat.com">mk-support@redhat.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"></ul>
</div> 

      <div class="footer-col footer-col-3">
        <p>This site contains resources about the architecture and processes for Red Hat Application Services.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
